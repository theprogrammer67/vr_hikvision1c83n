# Драйвер видеорегистратора Hikvision для 1С:БПО Native API vr_hikvision1c83n.dll

# Руководство по настройке и использованию

## Общая информация

Драйвер предназначен для взаимодействия конфигураций на платформе  1С:Предприятие 8.X с ПО "HIKVISION". Драйвер полностью соответствует стандарту "Требования к разработке драйверов подключаемого оборудования (версия 2.4)".

Драйвер выполнен по технолгии 1С: Native API

В данном документе описаны только специфические методоы драйвера. Описание общих методов, настроек и алгоритмов приводится в документации к 1С:Предприятие.

## Алгоритм работы

Большинство операций можно выполнять несколькими способами:

- Вызов соответствующего метода
- Установка/чтение параметра методами *УстановитьПараметр*/*ПолучитьПараметр*
- Прямая установка значения параметра как поля объекта драйвера

Драйвер позволяет отображать в окне формы 1С:Предприятие 8.3 видеопотоки с камер видеонаблюдения системы HIKVISION. Для функционирования драйвера необходимо наличие библиотек HIKVISION SDK, установленных в одном каталоге с файлом драйвера.

Видеопотоки отображаются на панели с окнами. Для каждого из окон настриваются параметры:

- Окно включено
- Номер канала
- Отображать текст поверх видео
- Отображаемый текст

Окна располагаются в сетке 1 * 1, 2 * 2, 3 * 3, 4 * 4. Максимальное количество окон - 16. Режим отображения сетки меняется с помощью свойства *PanelMode* или соответствующего метода. Доступ к параметрам окон возможен только после выполнения команды драйвера *Подключить*.  

Управление воспроизведением возможно как для всех окон сразу (*ВоспроизвестиПотокВсе*), так и для каждого отдельно. При выполнении групповых команд (*ВоспроизвестиПотокВсе*, *ОтображатьТекстВсе*), операции выполняются только над окнами, имеющими статус "Включено", выключенные окна игнорирутся.

Для панели существует понятие текущего (выбранного) окна. Выбор окна может быть выполнен как программно, так и интерактивно, с помощью щелчка мыши на нем. Существует ряд методов для установки/чтения параметров текущего окна и управления им.

## Методы

Все описанные методы возвращают значение типа *Boolean*. Результат False означает, что в процессе выполнения метода произошла ошибка. Описание последней ошибки можно получить с помощью метода *ПолучитьОшибку* (см. Требования к разработке драйверов подключаемого оборудования)

### УстановитьРежимПанели  (SetPanelMode)

Установить  режим (количество ячеек сетки панели)

#### Синтаксис

```
SetPanelMode(PanelMode: Number)
```

#### Параметры

##### PanelMode

0 - Одно окно;  1 - 2 * 2 окна; 2 - 3 * 3 окна; 3 - 4 * 4 окна

### ПолучитьРежимПанели  (GetPanelMode)

Получить режим (количество ячеек сетки панели)

#### Синтаксис

```
GetPanelMode(PanelMode: Number)
```

#### Параметры

##### PanelMode

0 - Одно окно;  1 - 2 * 2 окна; 2 - 3 * 3 окна; 3 - 4 * 4 окна

### УстановитьОкноВключено  (SetWindowEnabled)

Установить признак окна включено/выключено. Выключенные окна игнорируются при выполнении групповых методов *ВоспроизвестиПотокВсе*, *ОтображатьТекстВсе*

#### Синтаксис

```
SetWindowEnabled(Index: Number, Enabled: Boolean)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Enabled

True - включено; False - выключено

### ПолучитьОкноВключено  (GetWindowEnabled)

Установить признак окна включено/выключено.

#### Синтаксис

```
GetWindowEnabled(Index: Number, Enabled: Boolean)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Enabled

True - включено; False - выключено

### УстановитьВоспроизведениеПотока  (SetPlayLiveVideo)

Запустить/остановить воспроизведение текущего видеопотока с камеры

#### Синтаксис

```
SetPlayLiveVideo(Index: Number, Play: Boolean)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Play

True - запустить; False - остановить

### ПолучитьВоспроизведениеПотока  (GetPlayLiveVideo)

Получить текущее состояне воспроизведения - запущено/остановлено

#### Синтаксис

```
GetPlayLiveVideo(Index: Number, Play: Boolea)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Play

True - видео воспроизводится; False - видео не воспроизводится

### УстановитьТекст  (SetText)

Установить текст, отображаемый поверх видео

#### Синтаксис

```
SetText(Index: Number, Text: String)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Text

Строки текста, включая символы перевода каретки

### ПолучитьТекст  (GetText)

Получить текст, отображаемый поверх видео

#### Синтаксис

```
GetText(Index: Number, Text: String)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Text

Строки текста, включая символы перевода каретки

### УстановитьОтображатьТекст  (SetShowText)

Установить режим отображения текста поверх видео. При выключенном режиме, текст не отображается

#### Синтаксис

```
SetShowText(Index: Number, Show: Boolean)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Show

True - текст отображается; False - текст не отображается

### ПолучитьОтображатьТекст  (GetShowText)

Получить режим отображения текста поверх видео

#### Синтаксис

```
GetShowText(Index: Number, Show: Boolean)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Show

True - текст отображается; False - текст не отображается

### УстановитьКанал  (SetChannel)

Установить номер канала HIKVISION, связанного с данным окном

#### Синтаксис

```
SetChannel(Index: Number, Channel: Number)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Channel

Номер канала (1..16)

### ПолучитьКанал  (GetChannel)

Получить номер канала HIKVISION, связанного с данным окном

#### Синтаксис

```
GetChannel(Index: Number, Channel: Number)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Channel

Номер канала (1..16)

### ВключитьОкноВсе  (EnableWindowAll)

Устновить у всех окон панели признак "Включено"

#### Синтаксис

```
EnableWindowAll(Enabled: Boolean)
```

#### Параметры

##### Enabled

True - включить все окна; False - отключить все окна

### ВоспроизвестиПотокВсе  (PlayLiveAll)

Запустить/остановить воспроизведение видеопотока для всех видимых окон с установленным признаком "Включено"

#### Синтаксис

```
PlayLiveAll(Play: Boolean)
```

#### Параметры

##### Play

True - запустить воспроизведение; False - остановить воспроизведение

### ОтображатьТекстВсе  (ShowTextAll)

Устновить у всех окон панели режим отображения текста

#### Синтаксис

```
ShowTextAll(Show: Boolean)
```

#### Параметры

##### Show

True - отображать текст; False - не отображать текст

### УстановитьПараметрыОкна  (SetWIndowParams)

Установить все параметры определенного окна одной командой

#### Синтаксис

```
SetWIndowParams(Index: Number, Enabled: Boolean, Channel: Number, ShowText: Boolean, Text: String)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Enabled

True - включено; False - выключено

##### Channel

Номер канала (1..16)

##### ShowText

True - текст отображается; False - текст не отображается

##### Text

Строки текста, включая символы перевода каретки

### ПолучитьПараметрыОкна  (GetWIndowParams)

Получить все параметры определенного окна одной командой

#### Синтаксис

```
GetWIndowParams(Index: Number, Enabled: Boolean, Channel: Number, ShowText: Boolean, Text: String)
```

#### Параметры

##### Index

Индекс окна (0..15)

##### Enabled

True - включено; False - выключено

##### Channel

Номер канала (1..16)

##### ShowText

True - текст отображается; False - текст не отображается

##### Text

Строки текста, включая символы перевода каретки

### УстановитьТекущееОкно  (SetSelectedWindow)

Сделать окно текущим (для быстрого редактирования параметров, управления)

#### Синтаксис

```
SetSelectedWindow(Index: Number)
```

#### Параметры

##### Index

Индекс окна (0..15)

### ПолучитьТекущееОкно  (GetSelectedWindow)

Получить индекс текущего окна

#### Синтаксис

```
GetSelectedWindow(Index: Number)
```

#### Параметры

##### Index

Индекс окна (0..15)

## Свойства

### КлассРодительскогоОкна  (ParentWindowClass)

Имя класса родительского окна элемента формы. Панель видео встраивается в первое найденное окно с указанным классом (делает его родительским). Для последних версий платформы "1С:Предприятие" в качестве родительского окна необходимо использовать элемент формы "ОкноHTMLДокумента" (класс -"WebViewWindowClass"). Таких элементов должно быть не более одного на всех открытых в текущий момент формах. Для более ранних версий платформы имя класса для данного элемента может быть другим

#### Тип данных

Строка

#### Значение по-умолчанию

"WebViewWindowClass"

### РежимПанели  (PanelMode)

Режим панели определяет количество ячеек с окнами в сетке. 0 - Одно окно;  1 - 2 * 2 окна; 2 - 3 * 3 окна; 3 - 4 * 4 окна

#### Тип данных

Число (0..3)

#### Значение по-умолчанию

0

### АдресСервера  (ServerAddress)

IP-адрес ссервера Hikvision

#### Тип данных

Строка

#### Значение по-умолчанию

""

### ПортСервера  (ServerPort)

IP-порт сервера Hikvision

#### Тип данных

Число

#### Значение по-умолчанию

8000

### ЛогинСервера  (ServerLogin)

Имя пользователя сервера Hikvision

#### Тип данных

Строка

#### Значение по-умолчанию

""

### ПарольСервера  (ServerPassword)

Пароль пользователя сервера Hikvision

#### Тип данных

Строка

#### Значение по-умолчанию

""

### ТекущееОкно  (SelectedWindow)

Индекс текущего окна панели видео. Если текущее окно не выбрано, равен -1

#### Тип данных

Число

#### Значение по-умолчанию

Нет

### ОкноВключено  (WindowEnabled)

Текущее окно используется. Не имеет смысла, если текущее окно не выбрано

#### Тип данных

Булево

#### Значение по-умолчанию

Нет

### ОкноКанал  (WindowChannel)

Видеоканал Hikvision, назначенный для текущего окна. Не имеет смысла, если текущее окно не выбрано

#### Тип данных

Число

#### Значение по-умолчанию

Нет

### ОкноОтображатьТекст  (WindowShowText)

Отображать текст для текущего окна. Не имеет смысла, если текущее окно не выбрано

#### Тип данных

Булево

#### Значение по-умолчанию

Нет

### ОкноТекст  (WindowText)

Текст, отображаемый в текущем окне. Не имеет смысла, если текущее окно не выбрано

#### Тип данных

Строка

#### Значение по-умолчанию

Нет

### ОкноВоспроизведениеПотока  (WindowPlayLiveVideo)

Если поток с камеры воспроизводится текущим окном, имеет значение True, иначе - False. Не имеет смысла, если текущее окно не выбрано

#### Тип данных

Булево

#### Значение по-умолчанию

Нет

## События

### SelectWindow

Событие происходит при интерактивном выборе окна (щелчок мышью) в видеопанели

#### Синтаксис

```
ВнешнееСобытие(Источник: Строка, Событие: Строка, Данные: Строка)
```

#### Параметры

##### Источник

Всегда имеет значение "Видеорегистратор"

##### Событие

SelectWindow

##### Данные

Индекс выбранного окна - от "0" до "15"